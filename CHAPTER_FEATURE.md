# 章节识别与选择功能说明

## 功能概述

为CC-Word_Read小说阅读器添加了自动识别章节并可选择章节阅读的功能，完美融入现有的Word界面风格。

## 新增功能

### 1. 自动章节识别
- **智能解析**：支持多种章节标题格式
  - `第X章` 格式（如：第一章、第二章）
  - `第X卷` 格式（如：第一卷、第二卷）
  - `Chapter X` 英文格式
  - 数字章节格式（如：1. 2. 3.）
  - 序号章节格式（如：一、二、三、）
  - Markdown标题格式（# ## ###）
  - 卷/部分格式
  - 智能短标题识别

- **智能过滤**：
  - 自动过滤无效标题
  - 根据章节长度和内容质量评分
  - 支持自定义最小章节长度
  - 防止误识别

### 2. 章节选择对话框
- **美观界面**：
  - 与项目现有界面风格完全一致
  - 支持搜索章节标题
  - 显示章节进度百分比
  - 显示章节字数统计
  - 显示章节内容摘要

- **便捷操作**：
  - 键盘导航支持（上下箭头、回车选择、ESC关闭）
  - 鼠标点击选择
  - 当前章节高亮显示
  - 实时搜索过滤

### 3. 文件菜单集成
- **入口位置**：在文件菜单的"书签"部分添加"章节目录"选项
- **智能启用**：只有当文档包含章节时才启用该功能
- **图标设计**：使用📋图标，与Word风格保持一致

### 4. 章节导航功能
- **快速跳转**：点击章节直接跳转到对应位置
- **编辑器清空**：跳转章节时自动清空编辑器内容，从新章节开始输出
- **进度同步**：自动更新阅读进度
- **位置记忆**：自动记住当前所在章节
- **键盘快捷键**：
  - `Ctrl + ←`：跳转到上一章节
  - `Ctrl + →`：跳转到下一章节  
  - `Ctrl + Shift + C`：打开章节目录对话框

## 技术实现

### 新增文件

1. **类型定义** (`src/types/novel.d.ts`)
   ```typescript
   export interface Chapter {
     id: string
     title: string
     startPosition: number
     endPosition: number
     wordCount: number
     index: number
     level: number
   }
   ```

2. **章节解析器** (`src/utils/chapterParser.ts`)
   - 多种章节模式识别
   - 智能评分算法
   - 章节内容提取
   - 位置查找功能

3. **章节对话框组件** (`src/components/ChapterDialog.vue`)
   - 响应式设计
   - 搜索功能
   - 键盘导航
   - 美观的界面设计

### 功能扩展

1. **Novel Store扩展** (`src/stores/novel.ts`)
   - 添加章节状态管理
   - 自动章节解析
   - 章节跳转方法
   - 当前章节追踪

2. **Ribbon组件更新** (`src/components/Ribbon.vue`)
   - 添加章节目录菜单项
   - 集成章节对话框
   - 响应式启用/禁用

3. **文件导入更新** (`src/composables/useFileImporter.ts`)
   - 自动触发章节解析
   - 支持章节信息保存

## 使用方法

### 导入文件
1. 点击"文件"菜单
2. 选择"打开文件"
3. 导入TXT、DOCX或Markdown格式的小说文件
4. 系统自动识别章节结构

### 查看章节目录
1. 确保已导入包含章节的文件
2. 点击"文件"菜单
3. 选择"章节目录"（📋图标）
4. 在弹出的对话框中浏览章节列表

### 章节导航
1. 在章节目录中点击任意章节
2. 系统自动清空编辑器并跳转到对应位置
3. 使用搜索框快速查找特定章节
4. 使用键盘上下箭头键导航
5. 使用快捷键快速切换章节：
   - `Ctrl + ←`：上一章节
   - `Ctrl + →`：下一章节
   - `Ctrl + Shift + C`：打开章节目录

## 界面特色

- **Word风格**：完全融入现有的Microsoft Word 2021界面设计
- **响应式设计**：适配不同屏幕尺寸
- **流畅动画**：平滑的打开/关闭动画效果
- **直观图标**：使用易懂的图标和颜色标识
- **智能提示**：显示章节进度、字数等有用信息

## 兼容性

- 支持所有现有文件格式（TXT、DOCX、Markdown）
- 兼容现有的书签功能
- 不影响原有的阅读进度保存
- 完全向后兼容

## 测试文件

项目根目录下的 `test-novel.txt` 包含了一个完整的测试小说，包含：
- 标题：魔法森林的传说
- 10个章节 + 尾声
- 标准的"第X章"格式
- 适合测试章节识别功能

## 未来扩展

- 支持更多章节格式识别
- 添加章节书签功能
- 支持章节内搜索
- 添加章节阅读统计
- 支持自定义章节解析规则

---

该功能完全保持了项目的设计理念，为用户提供了更好的小说阅读体验，同时维持了"上班摸鱼"的伪装效果。
