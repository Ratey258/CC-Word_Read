# Word小说阅读器 - 完整开发文档

## 📋 第一章：项目概述

### 1.1 项目名称
**CC-Word_Read** - 像素级还原Word界面的小说阅读器

### 1.2 项目目标
开发一个完全模仿Microsoft Word 2022界面的Windows桌面应用程序，用于在工作环境中隐蔽地阅读小说。通过1:1还原Word的UI/UX，使应用看起来像是在使用正版Word进行文档编辑。

### 1.2.1 系统要求
- **操作系统**: Windows 10 (版本1809或更高) / Windows 11
- **架构**: x86_64 (64位)
- **浏览器内核**: Microsoft Edge WebView2 (Windows 10/11自带)
- **运行时**: 无需额外安装，使用系统自带WebView2

### 1.3 核心特性

#### 界面还原（1:1像素级）
- ✅ 标题栏：包含Word图标、窗口标题、最小化/最大化/关闭按钮
- ✅ Ribbon界面：完整的功能区带标签（文件、开始、插入等）
- ✅ 快速访问工具栏：常用图标按钮
- ✅ 文档编辑区：真实的Word页面样式（A4纸张、阴影效果）
- ✅ 状态栏：页码、字数统计、语言设置、缩放比例

#### 小说阅读功能
- 📖 支持导入TXT/MD/DOCX格式小说
- ⌨️ 按键伪装输入（任意按键触发小说文本输出）
- 💾 自动保存阅读进度
- 🎛️ 可自定义输出速度和字符数
- 🔄 中文输入法完美兼容

#### 伪装特性
- 🎭 任意按键都会输出小说内容（而非按键字符）
- 🖱️ 保持真实的文字选择和光标功能
- 📊 实时更新字数统计
- 🔒 无明显的"小说阅读器"标识

### 1.4 技术栈（2025更新）

#### 前端技术
- **HTML5** - 语义化结构层
- **CSS3** - 样式层（精确复刻Word UI，支持Container Queries）
- **JavaScript (ES2024+)** - 现代化交互逻辑
- **Bootstrap 5.3** - 响应式UI框架
- **Font Awesome 6.5** - SVG图标库
- **Mammoth.js** - DOCX文件解析引擎

#### 桌面框架（v2.0 - Windows专用）
- **Tauri 2.0** - Rust驱动的超轻量级桌面框架
- 优势：体积极小（2-4MB）、内存占用低、安全性高
- **WebView2** - Windows系统原生WebView（基于Edge Chromium）
- **目标平台**: Windows 10/11 (x64)

#### 存储方案
- **LocalStorage** - 轻量级配置存储
- **IndexedDB** - 大文件和小说内容存储

### 1.5 项目结构
```
CC-Word_Read/
├── index.html              # 主应用文件（单文件架构）
├── 示例小说.txt            # 测试用小说文件
├── LICENSE                 # MIT许可证
├── CHANGELOG.md           # 更新日志
├── 开发文档.md            # 本文档
└── .github/
    └── workflows/
        └── static.yml     # GitHub Pages部署配置
```

### 1.6 版本规划（Windows平台）
- **v1.0** (已发布 - 2024) - 网页版原型
- **v2.0** (进行中 - 2025 Q4) - Tauri 2.0 Windows桌面应用
- **v2.1** (2026 Q1) - 云同步 + AI功能
- **v2.2** (2026 Q2) - 增强功能和主题

---

## 🎨 第二章：Word 2022 UI设计规范

### 2.1 精确配色方案（取自Word 2022）

```css
:root {
  /* 标题栏 */
  --word-title-bar: #2b579a;
  --word-title-bar-text: #ffffff;
  --word-title-bar-hover: #3e6db5;
  
  /* Ribbon功能区 */
  --word-ribbon-bg: #f3f2f1;
  --word-ribbon-tab-bg: #ffffff;
  --word-ribbon-tab-active: #0078d4;
  --word-ribbon-tab-hover: #e1dfdd;
  --word-ribbon-border: #d1d1d1;
  --word-ribbon-separator: #edebe9;
  
  /* 按钮状态 */
  --word-button-default: transparent;
  --word-button-hover: #e5e5e5;
  --word-button-active: #d1d1d1;
  --word-button-text: #323130;
  --word-button-disabled: #a19f9d;
  
  /* 文档区域 */
  --word-canvas-bg: #e5e5e5;
  --word-page-bg: #ffffff;
  --word-page-shadow: rgba(0, 0, 0, 0.15);
  --word-page-border: #d1d1d1;
  
  /* 状态栏 */
  --word-statusbar-bg: #f3f2f1;
  --word-statusbar-text: #605e5c;
  --word-statusbar-hover: #e1dfdd;
  
  /* 文字和字体 */
  --word-font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
  --word-icon-font: 'Segoe Fluent Icons', 'Segoe MDL2 Assets';
  --word-text-primary: #323130;
  --word-text-secondary: #605e5c;
}
```

### 2.2 布局尺寸规范

#### 标题栏
- 高度: `31px`
- 图标大小: `16x16px`
- 按钮宽度: `46px`
- 按钮高度: `31px`
- 字体大小: `12px`

#### Ribbon功能区
- 总高度: `120px`
- 标签栏高度: `32px`
- 工具栏高度: `88px`
- 按钮间距: `2px`
- 分组间距: `8px`
- 大按钮: `48x64px`
- 小按钮: `24x24px`

#### 文档编辑区
- A4纸张: `794px × 1123px` (96 DPI)
- 页面边距: `20px`
- 页面阴影: `0 2px 8px rgba(0,0,0,0.15)`
- 行间距: `1.5`
- 默认字体: `Calibri 11pt` / `宋体 五号`

#### 状态栏
- 高度: `24px`
- 字体大小: `12px`
- 项目间距: `12px`

### 2.3 图标规范

#### 使用Font Awesome 6映射
```javascript
const wordIconMap = {
  // 快速访问工具栏
  save: 'fa-floppy-disk',
  undo: 'fa-arrow-rotate-left',
  redo: 'fa-arrow-rotate-right',
  
  // 文件菜单
  new: 'fa-file',
  open: 'fa-folder-open',
  print: 'fa-print',
  share: 'fa-share-nodes',
  
  // 开始标签
  bold: 'fa-bold',
  italic: 'fa-italic',
  underline: 'fa-underline',
  strikethrough: 'fa-strikethrough',
  alignLeft: 'fa-align-left',
  alignCenter: 'fa-align-center',
  alignRight: 'fa-align-right',
  alignJustify: 'fa-align-justify',
  bulletList: 'fa-list-ul',
  numberList: 'fa-list-ol',
  
  // 插入标签
  table: 'fa-table',
  image: 'fa-image',
  link: 'fa-link',
  comment: 'fa-comment',
  
  // 状态栏
  pageCount: 'fa-file-lines',
  wordCount: 'fa-font',
  language: 'fa-language',
  zoom: 'fa-magnifying-glass'
};
```

---

## ⚙️ 第三章：核心功能实现详解

### 3.1 伪装输入系统

#### 核心原理
任意按键触发时，不输出真实按键字符，而是从小说缓冲区取字符输出。

#### 实现代码
```javascript
class NovelReader {
  constructor() {
    this.novelText = '';        // 完整小说文本
    this.currentPosition = 0;   // 当前阅读位置
    this.outputSpeed = 1;       // 每次按键输出的字符数
    this.isActive = false;      // 是否激活伪装模式
  }
  
  // 按键拦截处理
  handleKeyPress(event) {
    if (!this.isActive) return;
    
    // 阻止默认行为（防止真实字符输入）
    event.preventDefault();
    event.stopPropagation();
    
    // 从小说中取字符
    const output = this.getNextChars(this.outputSpeed);
    
    // 插入到光标位置
    this.insertText(output);
    
    // 更新阅读进度
    this.saveProgress();
  }
  
  // 获取下一批字符
  getNextChars(count) {
    const chars = this.novelText.substr(this.currentPosition, count);
    this.currentPosition += chars.length;
    
    // 到达结尾时循环
    if (this.currentPosition >= this.novelText.length) {
      this.currentPosition = 0;
    }
    
    return chars;
  }
  
  // 插入文本到编辑器
  insertText(text) {
    const editor = document.getElementById('editor');
    const selection = window.getSelection();
    const range = selection.getRangeAt(0);
    
    // 删除选中内容
    range.deleteContents();
    
    // 插入新文本
    const textNode = document.createTextNode(text);
    range.insertNode(textNode);
    
    // 移动光标到末尾
    range.setStartAfter(textNode);
    range.collapse(true);
    selection.removeAllRanges();
    selection.addRange(range);
    
    // 更新字数统计
    this.updateWordCount();
  }
}
```

### 3.2 中文输入法兼容

#### 问题分析
中文输入法会触发`compositionstart`、`compositionupdate`、`compositionend`事件，需要特殊处理。

#### 解决方案
```javascript
class IMEHandler {
  constructor(reader) {
    this.reader = reader;
    this.isComposing = false;
    this.pendingText = '';
  }
  
  setupListeners() {
    const editor = document.getElementById('editor');
    
    // 开始输入
    editor.addEventListener('compositionstart', (e) => {
      this.isComposing = true;
      this.pendingText = '';
    });
    
    // 输入过程
    editor.addEventListener('compositionupdate', (e) => {
      this.pendingText = e.data;
    });
    
    // 完成输入
    editor.addEventListener('compositionend', (e) => {
      this.isComposing = false;
      
      // 删除输入法输出的内容
      this.removeIMEText(e.data.length);
      
      // 输出小说文本（根据输入字符数）
      const output = this.reader.getNextChars(e.data.length);
      this.reader.insertText(output);
    });
  }
  
  removeIMEText(length) {
    const selection = window.getSelection();
    const range = selection.getRangeAt(0);
    
    // 向前删除length个字符
    range.setStart(range.startContainer, range.startOffset - length);
    range.deleteContents();
  }
}
```

### 3.3 文件导入功能

#### 支持的格式
- **TXT**: 纯文本，直接读取
- **DOCX**: 使用Mammoth.js解析
- **MD**: Markdown格式，可选转换为HTML

#### 实现代码
```javascript
class FileImporter {
  async importFile(file) {
    const ext = file.name.split('.').pop().toLowerCase();
    
    switch(ext) {
      case 'txt':
        return await this.readAsText(file);
      case 'docx':
        return await this.readDocx(file);
      case 'md':
        return await this.readMarkdown(file);
      default:
        throw new Error('不支持的文件格式');
    }
  }
  
  // 读取TXT
  readAsText(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => resolve(e.target.result);
      reader.onerror = reject;
      reader.readAsText(file, 'UTF-8');
    });
  }
  
  // 读取DOCX
  async readDocx(file) {
    const arrayBuffer = await file.arrayBuffer();
    const result = await mammoth.extractRawText({ arrayBuffer });
    return result.value;
  }
  
  // 读取Markdown
  async readMarkdown(file) {
    const text = await this.readAsText(file);
    // 可选：移除Markdown标记
    return text.replace(/[#*_`\[\]()]/g, '');
  }
}
```

### 3.4 阅读进度保存

#### 使用LocalStorage持久化
```javascript
class ProgressManager {
  constructor(reader) {
    this.reader = reader;
    this.storageKey = 'novel_progress';
    this.autoSaveInterval = 5000; // 5秒自动保存
  }
  
  // 保存进度
  save() {
    const progress = {
      position: this.reader.currentPosition,
      totalLength: this.reader.novelText.length,
      novelHash: this.hashCode(this.reader.novelText),
      timestamp: Date.now(),
      editorContent: document.getElementById('editor').innerHTML
    };
    
    localStorage.setItem(this.storageKey, JSON.stringify(progress));
  }
  
  // 加载进度
  load() {
    const data = localStorage.getItem(this.storageKey);
    if (!data) return null;
    
    try {
      const progress = JSON.parse(data);
      
      // 验证小说是否匹配
      if (progress.novelHash === this.hashCode(this.reader.novelText)) {
        this.reader.currentPosition = progress.position;
        document.getElementById('editor').innerHTML = progress.editorContent;
        return true;
      }
    } catch (e) {
      console.error('加载进度失败', e);
    }
    
    return false;
  }
  
  // 自动保存
  startAutoSave() {
    setInterval(() => {
      this.save();
    }, this.autoSaveInterval);
  }
  
  // 简单哈希函数
  hashCode(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
      hash = ((hash << 5) - hash) + str.charCodeAt(i);
      hash = hash & hash;
    }
    return hash.toString(36);
  }
}
```

### 3.10 2025年新增特性

#### IndexedDB大文件存储
```javascript
// 使用IndexedDB存储大型小说文件（>5MB）
class NovelDatabase {
  constructor() {
    this.dbName = 'WordNovelReaderDB';
    this.version = 1;
  }
  
  async init() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.dbName, this.version);
      
      request.onerror = () => reject(request.error);
      request.onsuccess = () => resolve(request.result);
      
      request.onupgradeneeded = (event) => {
        const db = event.target.result;
        
        // 创建小说存储
        if (!db.objectStoreNames.contains('novels')) {
          const objectStore = db.createObjectStore('novels', { keyPath: 'id' });
          objectStore.createIndex('title', 'title', { unique: false });
          objectStore.createIndex('lastRead', 'lastRead', { unique: false });
        }
      };
    });
  }
  
  async saveNovel(novel) {
    const db = await this.init();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction(['novels'], 'readwrite');
      const store = transaction.objectStore('novels');
      const request = store.put({
        id: novel.id || Date.now().toString(),
        title: novel.title,
        content: novel.content,
        progress: novel.progress || 0,
        lastRead: new Date().toISOString(),
        totalChars: novel.content.length
      });
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }
  
  async getNovel(id) {
    const db = await this.init();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction(['novels'], 'readonly');
      const store = transaction.objectStore('novels');
      const request = store.get(id);
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }
  
  async listNovels() {
    const db = await this.init();
    return new Promise((resolve, reject) => {
      const transaction = db.transaction(['novels'], 'readonly');
      const store = transaction.objectStore('novels');
      const request = store.getAll();
      
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }
}

// 使用示例
const db = new NovelDatabase();
await db.saveNovel({
  title: '斗破苍穹',
  content: '三十年河东，三十年河西...',
  progress: 1500
});
```

#### CSS Container Queries支持
```css
/* 响应式Ribbon布局（根据容器宽度） */
.ribbon-group {
  container-type: inline-size;
  container-name: ribbon;
}

@container ribbon (max-width: 500px) {
  .ribbon-button {
    flex-direction: column;
    gap: 4px;
  }
  
  .ribbon-button-icon {
    font-size: 20px;
  }
  
  .ribbon-button-label {
    font-size: 10px;
  }
}

@container ribbon (min-width: 800px) {
  .ribbon-button {
    padding: 8px 16px;
  }
}
```

#### Web Locks API（多标签同步）
```javascript
// 防止多个标签同时编辑
async function acquireEditLock() {
  if (!navigator.locks) {
    console.warn('Web Locks API 不支持');
    return true;
  }
  
  try {
    await navigator.locks.request('novel_edit_lock', { mode: 'exclusive' }, async (lock) => {
      console.log('获得编辑锁');
      // 在这里执行编辑操作
      await new Promise(resolve => {
        window.addEventListener('beforeunload', resolve, { once: true });
      });
    });
  } catch (err) {
    console.error('无法获取锁:', err);
    alert('另一个标签正在编辑此文档');
    return false;
  }
}
```

#### 性能优化：使用Intersection Observer
```javascript
// 虚拟滚动优化大文档性能
class VirtualScroller {
  constructor(container, content, itemHeight = 24) {
    this.container = container;
    this.content = content;
    this.itemHeight = itemHeight;
    this.visibleItems = new Set();
    
    this.setupObserver();
  }
  
  setupObserver() {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            this.renderItem(entry.target);
          } else {
            this.unrenderItem(entry.target);
          }
        });
      },
      {
        root: this.container,
        rootMargin: '100px', // 预加载100px
        threshold: 0
      }
    );
    
    // 观察所有段落
    this.container.querySelectorAll('.paragraph').forEach(p => {
      observer.observe(p);
    });
  }
  
  renderItem(element) {
    const index = parseInt(element.dataset.index);
    const start = index * 1000;
    const end = start + 1000;
    element.textContent = this.content.slice(start, end);
    this.visibleItems.add(index);
  }
  
  unrenderItem(element) {
    const index = parseInt(element.dataset.index);
    element.textContent = ''; // 清空不可见内容
    this.visibleItems.delete(index);
  }
}
```

---

## 🚀 第四章：Tauri桌面应用迁移指南

### 4.1 为什么选择Tauri？（Windows版本）

#### 对比Electron (2025年数据)
| 特性 | Tauri 2.0 | Electron 33+ |
|------|-----------|--------------|
| 体积 | 2-4MB | 80-120MB |
| 内存占用 | 25-40MB | 150-250MB |
| 启动速度 | 极快 | 较慢 |
| 后端语言 | Rust | Node.js |
| 安全性 | 高（沙箱隔离） | 中 |
| 系统集成 | 原生WebView2 | Chromium |
| Windows集成 | 完美支持 | 较好 |

#### Tauri优势（针对Windows）
- ✅ 体积极小（用户下载快）
- ✅ 性能优秀（Rust后端）
- ✅ 安全可靠（自动更新、代码签名）
- ✅ 原生体验（使用Windows WebView2）
- ✅ 完美集成Windows 10/11

### 4.2 环境准备

#### Windows开发环境
```powershell
# 1. 安装Rust (推荐1.75+)
# 下载并运行: https://rustup.rs/
winget install Rustlang.Rustup

# 2. 安装Visual Studio构建工具 (2022或2025)
# 需要"使用C++的桌面开发"工作负载
winget install Microsoft.VisualStudio.2022.BuildTools

# 3. 安装Node.js (推荐LTS 22.x)
winget install OpenJS.NodeJS.LTS

# 4. WebView2运行时（Win10/11自带最新版）
# 验证版本：Win+R → msedge --version

# 5. 验证安装
rustc --version  # 应为 1.75+
node --version   # 应为 v22.x
npm --version    # 应为 10.x
```


### 4.3 创建Tauri项目

#### 方法一：从零开始（Tauri 2.0）
```bash
# 创建新项目（使用最新模板）
npm create tauri-app@latest

# 选择配置
✔ Project name · word-novel-reader
✔ Choose which language to use for your frontend · TypeScript / JavaScript
✔ Choose your package manager · npm (或 pnpm/yarn/bun)
✔ Choose your UI template · Vanilla
✔ Choose your UI flavor · TypeScript

# 进入项目
cd word-novel-reader

# 安装依赖
npm install

# 开发模式（热重载）
npm run tauri dev

# 构建生产版本
npm run tauri build

# Windows专用构建
npm run tauri build --target x86_64-pc-windows-msvc
```

#### 方法二：迁移现有项目
```bash
# 在现有项目中初始化Tauri
cd CC-Word_Read
npm install --save-dev @tauri-apps/cli
npm install @tauri-apps/api

# 安装常用插件
npm install @tauri-apps/plugin-dialog
npm install @tauri-apps/plugin-fs

# 初始化Tauri
npm run tauri init

# 配置向导
✔ App name: Word Novel Reader
✔ Window title: Document - Word
✔ Web assets location: .
✔ Dev server URL: http://localhost:8080
✔ Frontend dev command: (留空，使用静态HTML)
✔ Frontend build command: (留空)
```

### 4.4 项目结构调整

```
CC-Word_Read/
├── src/                    # 前端代码
│   ├── index.html
│   ├── styles/
│   │   └── word-ui.css
│   ├── scripts/
│   │   ├── reader.js
│   │   ├── ime-handler.js
│   │   └── file-importer.js
│   └── assets/
│       └── icons/
├── src-tauri/              # Tauri后端
│   ├── src/
│   │   └── main.rs         # Rust主程序
│   ├── icons/              # 应用图标
│   ├── Cargo.toml          # Rust依赖
│   └── tauri.conf.json     # Tauri配置
├── package.json
└── README.md
```

### 4.5 配置文件详解

#### tauri.conf.json（Tauri 2.0配置）
```json
{
  "build": {
    "beforeDevCommand": "",
    "beforeBuildCommand": "",
    "devPath": "../src",
    "distDir": "../src"
  },
  "productName": "Word Novel Reader",
  "version": "2.0.0",
  "identifier": "com.cc.word-reader",
  "app": {
    "windows": [
      {
        "title": "Document - Word",
        "width": 1200,
        "height": 800,
        "minWidth": 800,
        "minHeight": 600,
        "resizable": true,
        "fullscreen": false,
        "decorations": false,
        "transparent": false,
        "alwaysOnTop": false
      }
    ],
    "security": {
      "csp": "default-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self' data:"
    }
  },
  "bundle": {
    "active": true,
    "category": "Productivity",
    "copyright": "MIT License",
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ],
    "longDescription": "A novel reader disguised as Microsoft Word",
    "shortDescription": "Word-like Novel Reader",
    "targets": "all",
    "windows": {
      "certificateThumbprint": null,
      "digestAlgorithm": "sha256",
      "timestampUrl": ""
    }
  },
  "plugins": {
    "updater": {
      "active": false
    }
  }
}
```

### 4.6 自定义窗口控制

#### 隐藏默认标题栏
配置中设置 `"decorations": false`，然后用HTML/CSS实现自定义标题栏。

#### 实现拖动
```javascript
import { getCurrentWindow } from '@tauri-apps/api/window';
const appWindow = getCurrentWindow();

// 标题栏元素
const titleBar = document.getElementById('title-bar');

// 设置data-tauri-drag-region属性
titleBar.setAttribute('data-tauri-drag-region', '');

// 或使用JavaScript
titleBar.addEventListener('mousedown', (e) => {
  if (e.button === 0) {
    appWindow.startDragging();
  }
});
```

#### 窗口控制按钮
```javascript
import { getCurrentWindow } from '@tauri-apps/api/window';
const appWindow = getCurrentWindow();

// 最小化
document.getElementById('btn-minimize').addEventListener('click', () => {
  appWindow.minimize();
});

// 最大化/还原
document.getElementById('btn-maximize').addEventListener('click', async () => {
  const isMaximized = await appWindow.isMaximized();
  if (isMaximized) {
    appWindow.unmaximize();
  } else {
    appWindow.maximize();
  }
});

// 关闭
document.getElementById('btn-close').addEventListener('click', () => {
  appWindow.close();
});
```

### 4.7 文件系统API调用

#### 使用Tauri的对话框
```javascript
import { open } from '@tauri-apps/plugin-dialog';
import { readTextFile } from '@tauri-apps/plugin-fs';

// 打开文件对话框
async function importNovel() {
  try {
    const selected = await open({
      multiple: false,
      filters: [{
        name: '小说文件',
        extensions: ['txt', 'md']
      }]
    });
    
    if (selected) {
      const content = await readTextFile(selected);
      novelReader.loadNovel(content);
    }
  } catch (err) {
    console.error('导入失败:', err);
  }
}
```

### 4.8 构建与打包

#### 开发模式
```bash
# 热重载开发
npm run tauri dev
```

#### 生产构建
```bash
# Windows
npm run tauri build

# 生成文件位置
# MSI安装包: src-tauri/target/release/bundle/msi/
# NSIS安装包: src-tauri/target/release/bundle/nsis/
# 便携版EXE: src-tauri/target/release/word-novel-reader.exe
```

#### 自定义构建目标
```bash
# 仅MSI
npm run tauri build -- --bundles msi

# 仅NSIS
npm run tauri build -- --bundles nsis

# 仅可执行文件
npm run tauri build -- --bundles none
```

### 4.9 优化建议

#### 减小体积
```toml
# Cargo.toml
[profile.release]
strip = true        # 移除调试符号
lto = true          # 链接时优化
codegen-units = 1   # 优化代码生成
opt-level = "z"     # 最小体积优化
```

#### 加快启动速度
- 延迟加载非关键资源
- 优化初始HTML大小
- 使用资源预加载

---

## 📦 第五章：部署与发布

### 5.1 GitHub Pages部署（网页版）

#### 配置文件
当前项目已配置`.github/workflows/static.yml`，自动部署到GitHub Pages。

```yaml
name: Deploy static content to Pages

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Pages
        uses: actions/configure-pages@v5
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

#### 启用步骤
1. 进入仓库Settings → Pages
2. Source选择"GitHub Actions"
3. 推送代码到main分支自动触发部署
4. 访问：`https://[username].github.io/CC-Word_Read/`

### 5.2 Tauri应用发布

#### Windows发布流程

##### 1. 准备签名证书（可选但推荐）
```powershell
# 生成自签名证书（开发测试用）
New-SelfSignedCertificate `
  -Subject "CN=Your Company Name" `
  -Type CodeSigningCert `
  -CertStoreLocation "Cert:\CurrentUser\My"

# 导出证书
# 打开certmgr.msc → 个人 → 证书 → 右键导出
```

##### 2. 配置签名
在`tauri.conf.json`中添加：
```json
{
  "tauri": {
    "bundle": {
      "windows": {
        "certificateThumbprint": "YOUR_CERT_THUMBPRINT",
        "digestAlgorithm": "sha256",
        "timestampUrl": "http://timestamp.digicert.com"
      }
    }
  }
}
```

##### 3. 构建发布版本
```bash
npm run tauri build
```

##### 4. 测试安装包
- MSI：双击安装，测试安装/卸载流程
- NSIS：测试静默安装 `/S` 参数
- 便携版EXE：直接运行测试

##### 5. 发布到GitHub Releases
```bash
# 创建Git标签
git tag v2.0.0
git push origin v2.0.0

# 在GitHub仓库创建Release
# 上传构建产物：
# - word-novel-reader_2.0.0_x64_en-US.msi
# - word-novel-reader_2.0.0_x64-setup.exe
# - word-novel-reader.exe (便携版)
```


### 5.3 自动更新配置

#### 使用Tauri Updater

##### 1. 启用更新器
```json
// tauri.conf.json
{
  "tauri": {
    "updater": {
      "active": true,
      "endpoints": [
        "https://releases.myapp.com/{{target}}/{{current_version}}"
      ],
      "dialog": true,
      "pubkey": "YOUR_PUBLIC_KEY"
    }
  }
}
```

##### 2. 生成密钥对
```bash
# 生成更新签名密钥
npm run tauri signer generate -- -w ~/.tauri/myapp.key

# 输出公钥（添加到配置）
npm run tauri signer sign ~/.tauri/myapp.key
```

##### 3. 签名发布文件
```bash
# 对更新包签名
npm run tauri signer sign \
  src-tauri/target/release/bundle/msi/app.msi \
  -k ~/.tauri/myapp.key
```

##### 4. 部署更新服务器
创建JSON端点返回：
```json
{
  "version": "2.1.0",
  "date": "2025-10-09",
  "platforms": {
    "windows-x86_64": {
      "url": "https://releases.myapp.com/app_2.1.0_x64.msi",
      "signature": "BASE64_SIGNATURE"
    }
  }
}
```

### 5.4 版本管理策略

#### 语义化版本（SemVer）
```
主版本号.次版本号.修订号

2.1.3
│ │ └─ 修复bug
│ └─── 新增功能（向下兼容）
└───── 重大更新（可能不兼容）
```

#### 发布检查清单
- [ ] 更新版本号（package.json + tauri.conf.json）
- [ ] 更新CHANGELOG.md
- [ ] 运行完整测试
- [ ] 构建所有平台安装包
- [ ] 测试安装/卸载流程
- [ ] 签名所有二进制文件
- [ ] 创建Git标签
- [ ] 发布GitHub Release
- [ ] 更新文档网站
- [ ] 通知用户更新

---

## 🔧 第六章：使用指南

### 6.1 首次使用

#### 启动应用
1. 双击运行（桌面版）或访问网页版链接
2. 看到Word风格界面
3. 点击"文件" → "打开"导入小说

#### 导入小说
```
支持格式：
- TXT (UTF-8编码)
- DOCX (Word文档)
- MD (Markdown)

操作步骤：
1. 点击"文件" → "打开"
2. 选择小说文件
3. 自动加载到编辑区
```

#### 激活伪装模式
1. 点击编辑区聚焦
2. 直接按任意键盘按键
3. 小说内容自动输出（而非按键字符）

### 6.2 快捷键

| 功能 | 快捷键 | 说明 |
|------|--------|------|
| 导入小说 | `Ctrl+O` | 打开文件对话框 |
| 新建文档 | `Ctrl+N` | 清空当前内容 |
| 保存进度 | `Ctrl+S` | 手动保存 |
| 增加速度 | `Ctrl++` | 每次按键输出更多字符 |
| 减少速度 | `Ctrl+-` | 每次按键输出更少字符 |
| 暂停/恢复 | `Ctrl+P` | 切换伪装模式 |
| 跳转进度 | `Ctrl+G` | 跳转到指定位置 |

### 6.3 设置选项

#### 输出速度
```javascript
// 调整每次按键输出的字符数
设置 → 输出速度: 1-10字符/按键
默认：1字符/按键
推荐：2-3字符/按键（自然打字速度）
```

#### 自动保存
```javascript
// 自动保存间隔
设置 → 自动保存: 开启/关闭
间隔：5秒（默认）
```

#### 主题切换
```javascript
// 切换Word主题
设置 → 主题:
- 经典白色（默认）
- 深色模式
- 彩色蓝
```

### 6.4 常见问题

#### Q1: 为什么按键没有输出小说内容？
**A:** 确保：
1. 已导入小说文件
2. 光标在编辑区内
3. 伪装模式已激活（查看状态栏）

#### Q2: 中文输入法不工作？
**A:** 
- 中文输入法完全支持
- 输入拼音后按空格，会输出对应字符数的小说内容
- 而非输入的中文字符

#### Q3: 如何重置阅读进度？
**A:** 
```
方法1: 点击"文件" → "重新开始"
方法2: 删除浏览器LocalStorage
```

#### Q4: 导入的DOCX为什么乱码？
**A:** 
- 确保DOCX文件正常（用Word能打开）
- 避免包含大量格式和图片
- 推荐转为TXT后导入

#### Q5: 能否在多台设备同步进度？
**A:** 
- 网页版：使用浏览器同步（如Chrome同步）
- 桌面版：计划支持云端同步（v2.1）

---

## 🎯 第七章：开发路线图（Windows专用版本）

### v2.0 (2025 Q4) - Windows桌面版
- [x] Tauri 2.0框架集成研究
- [x] 技术文档完善
- [ ] 实现自定义窗口控制
- [ ] Windows安装包（MSI/NSIS）
- [ ] 代码签名（Windows Authenticode）
- [ ] 完整测试套件
- [ ] Windows 10/11兼容性测试

### v2.1 (2026 Q1) - 增强功能
- [ ] 云端进度同步（WebDAV/自建服务器）
- [ ] 多小说管理（书库功能）
- [ ] 书签和笔记系统
- [ ] PDF/EPUB格式支持
- [ ] AI阅读摘要（本地LLM）
- [ ] Windows通知集成

### v2.2 (2026 Q2) - 主题与扩展
- [ ] 更多主题（Office 2019/2021/2024风格）
- [ ] 插件系统（Wasm扩展）
- [ ] 语音朗读（Windows TTS/Azure TTS）
- [ ] 实时翻译（本地模型）
- [ ] 深色模式完全支持
- [ ] Windows 11云母效果（Mica）

### v2.3 (2026 Q3) - 高级功能
- [ ] Excel/PPT界面模式
- [ ] 在线小说源聚合
- [ ] 社区分享功能
- [ ] 自动更新优化
- [ ] 便携版（绿色版）

---

## 📚 附录

### A. 技术参考

#### Word UI设计文档
- [Microsoft Fluent Design System](https://fluent2.microsoft.design/)
- [Office UI Fabric](https://developer.microsoft.com/en-us/fluentui)

#### Tauri官方文档
- [Tauri Guides](https://tauri.app/v2/guides/)
- [Tauri API Docs](https://tauri.app/v2/api/js/)

#### JavaScript API
- [Selection API](https://developer.mozilla.org/en-US/docs/Web/API/Selection)
- [Range API](https://developer.mozilla.org/en-US/docs/Web/API/Range)
- [CompositionEvent](https://developer.mozilla.org/en-US/docs/Web/API/CompositionEvent)

### B. 贡献指南

欢迎提交Issue和Pull Request！

#### 提交Issue
- 描述问题或功能请求
- 提供复现步骤
- 附上截图/日志

#### 提交PR
1. Fork项目
2. 创建功能分支
3. 提交代码（遵循现有风格）
4. 推送到Fork仓库
5. 创建Pull Request

### C. 许可证

```
MIT License

Copyright (c) 2024-2025 CC-Word_Read

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

## 📞 联系方式

- **GitHub**: [CC-Word_Read](https://github.com/your-repo/CC-Word_Read)
- **Issues**: [报告问题](https://github.com/your-repo/CC-Word_Read/issues)
- **Discussions**: [讨论区](https://github.com/your-repo/CC-Word_Read/discussions)

---

**最后更新**: 2025年10月9日  
**文档版本**: 1.0  
**作者**: CC-Word_Read Team

