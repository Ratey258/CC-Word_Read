# 更新日志

## [0.5.0] - 2025-11-17

### 🏗️ 架构重构
• **现代化基础设施升级**：引入专业的 IndexedDB 存储方案（idb）替代 localStorage，支持大数据存储并提供自动降级机制
• **统一日志系统**：实现分级日志管理（DEBUG/INFO/WARN/ERROR），区分开发和生产环境，替换所有 console.log（共 44 处）
• **类型安全事件总线**：使用 mitt 替代 window 自定义事件（共 6 处），提供完整的 TypeScript 类型支持
• **全局错误处理**：创建统一的错误处理服务，支持错误分类、用户友好提示和错误上报扩展

### 🐛 修复问题
• **启动白屏问题**：优化应用初始化流程，改为非阻塞式加载，Vue 应用立即挂载避免白屏，存储服务后台初始化
• **内存泄漏风险**：完善所有组件的事件监听器清理逻辑，正确清理 MutationObserver 和 DOM 事件

### 🎨 性能优化
• **非阻塞式初始化**：应用启动时先渲染界面再异步初始化服务，显著提升启动速度和用户体验
• **存储性能提升**：IndexedDB 支持更大容量数据存储，突破 localStorage 的 5-10MB 限制

### 🔧 优化改进
• **代码质量提升**：移除所有硬编码的 UI 尺寸值，统一使用常量管理，提高可维护性
• **依赖更新**：新增 mitt (3.0.1)、idb (8.0.3)、pinia-plugin-persistedstate (4.7.1) 等现代化依赖
• **服务层架构**：新增 services 目录，包含 eventBus、logger、storage、errorHandler 四个核心服务（共 615 行）

### 📝 技术债务清理
• **清理残余代码**：移除 44 处 console.log/console.error，6 处 window.dispatchEvent
• **类型安全增强**：所有事件通信和日志调用都具备完整的 TypeScript 类型检查
• **代码规范统一**：所有核心文件（8 个）已应用新的日志系统和事件总线

### 🎯 开发体验
• **更好的调试能力**：结构化日志输出，支持日志级别过滤，便于开发和生产环境调试
• **更强的可测试性**：服务层解耦，便于单元测试和集成测试
• **更清晰的错误提示**：统一的错误处理机制，提供用户友好的错误消息

---

## [0.4.0] - 2025-11-16

### ✨ 新增功能
• **更新失败手动下载入口**：更新对话框在无法连接更新服务器时，会直接显示蓝奏云备用下载地址与访问密码，并提供一键打开下载页面的按钮
• **启动自动检查更新开关**：设置中新增“启动时自动检查更新”选项，可按需关闭静默检查，避免在摸鱼场景下被打断

### 🐛 修复问题
• **桌面版无法打开下载页面**：在 Tauri 环境下接入 Opener 插件并补充权限配置，修复“打开下载页面”按钮无反应的问题
• **更新失败提示不清晰**：区分“暂无可用更新”和“网络/服务器异常”，避免没有新版本时仍弹出错误提示

### 🎨 性能优化
• **阅读滚动细节优化**：进一步统一阅读模式与编辑模式下的滚动策略，减少内容输出时的轻微抖动，让视图更稳定地跟随光标或内容末尾

### 🖼️ 界面样式
• **更新失败弹窗布局重构**：手动下载区域采用标签 + 文本 + 按钮的左右对齐布局，两行复制按钮保持统一横坐标，更符合整体界面风格
• **复制按钮样式统一**：为下载地址和密码使用与项目一致的浅灰小按钮样式，与底部主操作按钮区分但保持整体协调

### 🔧 优化改进
• **复制操作反馈优化**：下载地址和访问密码支持一键复制，并在复制成功后弹出“已复制到剪贴板”的提示，减少反复确认
• **更新模块结构梳理**：集中整理更新检查与手动下载逻辑，后续扩展发布渠道或调整更新策略时更易维护
